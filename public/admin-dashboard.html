<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸš– ××¢×¨×›×ª × ×™×”×•×œ ××•× ×™×•×ª - ×××©×§ × ×™×”×•×œ</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f5f7fa;
      color: #2c3e50;
    }

    /* Header */
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 1rem 2rem;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header h1 {
      font-size: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .logout-btn {
      background: rgba(255,255,255,0.2);
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 5px;
      color: white;
      cursor: pointer;
      transition: all 0.3s;
    }

    .logout-btn:hover {
      background: rgba(255,255,255,0.3);
    }

    /* Layout */
    .container {
      display: flex;
      min-height: calc(100vh - 70px);
    }

    /* Sidebar */
    .sidebar {
      width: 250px;
      background: white;
      box-shadow: 2px 0 10px rgba(0,0,0,0.05);
      padding: 1rem 0;
    }

    .nav-item {
      padding: 1rem 1.5rem;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      border-right: 3px solid transparent;
    }

    .nav-item:hover {
      background: #f8f9fa;
      border-right-color: #667eea;
    }

    .nav-item.active {
      background: #f0f2ff;
      border-right-color: #667eea;
      color: #667eea;
      font-weight: 600;
    }

    .nav-item i {
      width: 20px;
      text-align: center;
    }

    /* Main Content */
    .main-content {
      flex: 1;
      padding: 2rem;
      overflow-y: auto;
    }

    .page {
      display: none;
    }

    .page.active {
      display: block;
    }

    /* Stats Cards */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .stat-card {
      background: white;
      padding: 1.5rem;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .stat-icon {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
    }

    .stat-icon.blue { background: #e3f2fd; color: #2196F3; }
    .stat-icon.green { background: #e8f5e9; color: #4CAF50; }
    .stat-icon.orange { background: #fff3e0; color: #FF9800; }
    .stat-icon.purple { background: #f3e5f5; color: #9C27B0; }

    .stat-info h3 {
      font-size: 2rem;
      margin-bottom: 0.25rem;
    }

    .stat-info p {
      color: #7f8c8d;
      font-size: 0.9rem;
    }

    /* Table */
    .table-container {
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      overflow: hidden;
      margin-bottom: 2rem;
    }

    .table-header {
      padding: 1.5rem;
      border-bottom: 1px solid #ecf0f1;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .table-header h2 {
      font-size: 1.25rem;
      color: #2c3e50;
    }

    .btn {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 0.9rem;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }

    .btn-primary {
      background: #667eea;
      color: white;
    }

    .btn-primary:hover {
      background: #5568d3;
    }

    .btn-success {
      background: #4CAF50;
      color: white;
    }

    .btn-danger {
      background: #f44336;
      color: white;
    }

    .btn-secondary {
      background: #6c757d;
      color: white;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      padding: 1rem;
      text-align: right;
      border-bottom: 1px solid #ecf0f1;
    }

    th {
      background: #f8f9fa;
      font-weight: 600;
      color: #495057;
      font-size: 0.9rem;
    }

    tr:hover {
      background: #f8f9fa;
    }

    .badge {
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 500;
    }

    .badge-success { background: #d4edda; color: #155724; }
    .badge-warning { background: #fff3cd; color: #856404; }
    .badge-danger { background: #f8d7da; color: #721c24; }
    .badge-info { background: #d1ecf1; color: #0c5460; }

    /* Loading */
    .loading {
      text-align: center;
      padding: 3rem;
      color: #7f8c8d;
    }

    .spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #667eea;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 1rem;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .empty-state {
      text-align: center;
      padding: 3rem;
      color: #7f8c8d;
    }

    .empty-state i {
      font-size: 3rem;
      margin-bottom: 1rem;
      opacity: 0.3;
    }

    /* Actions */
    .actions {
      display: flex;
      gap: 0.5rem;
    }

    .action-btn {
      padding: 0.25rem 0.5rem;
      border: none;
      border-radius: 3px;
      cursor: pointer;
      font-size: 0.85rem;
    }

    /* Search */
    .search-box {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
      padding: 1.5rem;
      background: white;
      border-radius: 10px;
    }

    .search-box input {
      flex: 1;
      padding: 0.75rem;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 1rem;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .sidebar {
        width: 200px;
      }
      
      .stats-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="header">
    <h1>
      <i class="fas fa-taxi"></i>
      ××¢×¨×›×ª × ×™×”×•×œ ××•× ×™×•×ª
    </h1>
    <div class="user-info">
      <span><i class="fas fa-user"></i> <span id="username">×× ×”×œ</span></span>
      <button class="logout-btn" onclick="logout()">
        <i class="fas fa-sign-out-alt"></i> ×™×¦×™××”
      </button>
    </div>
  </div>

  <div class="container">
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="nav-item active" onclick="showPage('dashboard')">
        <i class="fas fa-home"></i>
        <span>×“×©×‘×•×¨×“</span>
      </div>
      <div class="nav-item" onclick="showPage('rides')">
        <i class="fas fa-car"></i>
        <span>× ×¡×™×¢×•×ª</span>
      </div>
      <div class="nav-item" onclick="showPage('drivers')">
        <i class="fas fa-user-tie"></i>
        <span>× ×”×’×™×</span>
      </div>
      <div class="nav-item" onclick="showPage('registrations')">
        <i class="fas fa-user-plus"></i>
        <span>×¨×™×©×•××™×</span>
      </div>
      <div class="nav-item" onclick="showPage('groups')">
        <i class="fas fa-users"></i>
        <span>×§×‘×•×¦×•×ª</span>
      </div>
      <div class="nav-item" onclick="showPage('statistics')">
        <i class="fas fa-chart-line"></i>
        <span>×¡×˜×˜×™×¡×˜×™×§×•×ª</span>
      </div>
      <div class="nav-item" onclick="showPage('activities')">
        <i class="fas fa-history"></i>
        <span>×¤×¢×™×œ×•×ª</span>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Dashboard Page -->
      <div id="dashboard" class="page active">
        <h1 style="margin-bottom: 2rem;">ğŸ“Š ×“×©×‘×•×¨×“ ×¨××©×™</h1>
        
        <div class="stats-grid" id="statsGrid">
          <div class="stat-card">
            <div class="stat-icon blue">
              <i class="fas fa-car"></i>
            </div>
            <div class="stat-info">
              <h3 id="totalRides">0</h3>
              <p>×¡×”"×› × ×¡×™×¢×•×ª</p>
            </div>
          </div>
          
          <div class="stat-card">
            <div class="stat-icon green">
              <i class="fas fa-user-tie"></i>
            </div>
            <div class="stat-info">
              <h3 id="activeDrivers">0</h3>
              <p>× ×”×’×™× ×¤×¢×™×œ×™×</p>
            </div>
          </div>
          
          <div class="stat-card">
            <div class="stat-icon orange">
              <i class="fas fa-clock"></i>
            </div>
            <div class="stat-info">
              <h3 id="todayRides">0</h3>
              <p>× ×¡×™×¢×•×ª ×”×™×•×</p>
            </div>
          </div>
          
          <div class="stat-card">
            <div class="stat-icon purple">
              <i class="fas fa-shekel-sign"></i>
            </div>
            <div class="stat-info">
              <h3 id="todayRevenue">â‚ª0</h3>
              <p>×”×›× ×¡×•×ª ×”×™×•×</p>
            </div>
          </div>
        </div>

        <div class="table-container">
          <div class="table-header">
            <h2>×¤×¢×™×œ×•×ª ××—×¨×•× ×”</h2>
          </div>
          <div id="recentActivity">
            <div class="loading">
              <div class="spinner"></div>
              <p>×˜×•×¢×Ÿ...</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Rides Page -->
      <div id="rides" class="page">
        <div class="table-container">
          <div class="table-header">
            <h2>ğŸš— × ×™×”×•×œ × ×¡×™×¢×•×ª</h2>
            <button class="btn btn-primary" onclick="createNewRide()">
              <i class="fas fa-plus"></i> × ×¡×™×¢×” ×—×“×©×”
            </button>
          </div>
          <div class="search-box">
            <input type="text" id="ridesSearch" placeholder="×—×™×¤×•×© ×œ×¤×™ ×œ×§×•×—, × ×”×’ ××• ××¡×¤×¨ × ×¡×™×¢×”..." oninput="filterRides()">
            <button class="btn btn-secondary" onclick="loadRides()">
              <i class="fas fa-sync"></i> ×¨×¢× ×Ÿ
            </button>
          </div>
          <div id="ridesTable">
            <div class="loading">
              <div class="spinner"></div>
              <p>×˜×•×¢×Ÿ × ×¡×™×¢×•×ª...</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Drivers Page -->
      <div id="drivers" class="page">
        <div class="table-container">
          <div class="table-header">
            <h2>ğŸ‘¨â€âœˆï¸ × ×™×”×•×œ × ×”×’×™×</h2>
            <button class="btn btn-primary" onclick="addDriver()">
              <i class="fas fa-plus"></i> ×”×•×¡×£ × ×”×’
            </button>
          </div>
          <div class="search-box">
            <input type="text" id="driversSearch" placeholder="×—×™×¤×•×© ×œ×¤×™ ×©× ××• ×˜×œ×¤×•×Ÿ..." oninput="filterDrivers()">
            <button class="btn btn-secondary" onclick="loadDrivers()">
              <i class="fas fa-sync"></i> ×¨×¢× ×Ÿ
            </button>
          </div>
          <div id="driversTable">
            <div class="loading">
              <div class="spinner"></div>
              <p>×˜×•×¢×Ÿ × ×”×’×™×...</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Registrations Page -->
      <div id="registrations" class="page">
        <div class="table-container">
          <div class="table-header">
            <h2>ğŸ“ ×¨×™×©×•××™× ×××ª×™× ×™×</h2>
          </div>
          <div id="registrationsTable">
            <div class="loading">
              <div class="spinner"></div>
              <p>×˜×•×¢×Ÿ ×¨×™×©×•××™×...</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Groups Page -->
      <div id="groups" class="page">
        <div class="table-container">
          <div class="table-header">
            <h2>ğŸ‘¥ ×§×‘×•×¦×•×ª WhatsApp</h2>
            <button class="btn btn-primary" onclick="createGroup()">
              <i class="fas fa-plus"></i> ×§×‘×•×¦×” ×—×“×©×”
            </button>
          </div>
          <div id="groupsTable">
            <div class="loading">
              <div class="spinner"></div>
              <p>×˜×•×¢×Ÿ ×§×‘×•×¦×•×ª...</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Statistics Page -->
      <div id="statistics" class="page">
        <h1 style="margin-bottom: 2rem;">ğŸ“ˆ ×¡×˜×˜×™×¡×˜×™×§×•×ª ××¤×•×¨×˜×•×ª</h1>
        <div id="statisticsContent">
          <div class="loading">
            <div class="spinner"></div>
            <p>×˜×•×¢×Ÿ ×¡×˜×˜×™×¡×˜×™×§×•×ª...</p>
          </div>
        </div>
      </div>

      <!-- Activities Page -->
      <div id="activities" class="page">
        <div class="table-container">
          <div class="table-header">
            <h2>ğŸ• ×™×•××Ÿ ×¤×¢×™×œ×•×ª ××¢×¨×›×ª</h2>
            <button class="btn btn-secondary" onclick="loadActivities()">
              <i class="fas fa-sync"></i> ×¨×¢× ×Ÿ
            </button>
          </div>
          <div id="activitiesTable">
            <div class="loading">
              <div class="spinner"></div>
              <p>×˜×•×¢×Ÿ ×¤×¢×™×œ×•×™×•×ª...</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Global variables
    let allRides = [];
    let allDrivers = [];

    // Authentication check
    const token = localStorage.getItem('token');
    if (!token) {
      window.location.href = '/login.html';
    }

    // API Helper
    async function apiCall(endpoint, options = {}) {
      const defaultOptions = {
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`
        }
      };

      try {
        const response = await fetch(endpoint, { ...defaultOptions, ...options });
        
        if (response.status === 401) {
          localStorage.removeItem('token');
          window.location.href = '/login.html';
          return null;
        }

        if (!response.ok) {
          throw new Error(`HTTP ${response.status}`);
        }

        return await response.json();
      } catch (error) {
        console.error('API Error:', error);
        return null;
      }
    }

    // Navigation
    function showPage(pageId) {
      // Remove active from all nav items
      document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
      });
      
      // Remove active from all pages
      document.querySelectorAll('.page').forEach(page => {
        page.classList.remove('active');
      });
      
      // Add active to clicked nav item
      event.target.closest('.nav-item').classList.add('active');
      
      // Show selected page
      document.getElementById(pageId).classList.add('active');
      
      // Load page data
      loadPageData(pageId);
    }

    function loadPageData(pageId) {
      switch(pageId) {
        case 'dashboard':
          loadDashboard();
          break;
        case 'rides':
          loadRides();
          break;
        case 'drivers':
          loadDrivers();
          break;
        case 'registrations':
          loadRegistrations();
          break;
        case 'groups':
          loadGroups();
          break;
        case 'statistics':
          loadStatistics();
          break;
        case 'activities':
          loadActivities();
          break;
      }
    }

    // Dashboard
    async function loadDashboard() {
      const stats = await apiCall('/api/statistics');
      if (stats) {
        document.getElementById('totalRides').textContent = stats.totalRides || 0;
        document.getElementById('activeDrivers').textContent = stats.activeDrivers || 0;
        document.getElementById('todayRides').textContent = stats.todayRides || 0;
        document.getElementById('todayRevenue').textContent = `â‚ª${stats.todayRevenue || 0}`;
      }

      const activities = await apiCall('/api/activities?limit=10');
      if (activities) {
        renderActivities(activities, 'recentActivity');
      }
    }

    // Rides
    async function loadRides() {
      document.getElementById('ridesTable').innerHTML = '<div class="loading"><div class="spinner"></div><p>×˜×•×¢×Ÿ...</p></div>';
      
      const rides = await apiCall('/api/rides');
      if (rides) {
        allRides = rides;
        renderRides(rides);
      }
    }

    function renderRides(rides) {
      if (!rides || rides.length === 0) {
        document.getElementById('ridesTable').innerHTML = '<div class="empty-state"><i class="fas fa-car"></i><h3>××™×Ÿ × ×¡×™×¢×•×ª</h3></div>';
        return;
      }

      let html = `
        <table>
          <thead>
            <tr>
              <th>××¡×¤×¨ × ×¡×™×¢×”</th>
              <th>×œ×§×•×—</th>
              <th>×˜×œ×¤×•×Ÿ</th>
              <th>××™×¡×•×£</th>
              <th>×™×¢×“</th>
              <th>××—×™×¨</th>
              <th>× ×”×’</th>
              <th>×¡×˜×˜×•×¡</th>
              <th>×¤×¢×•×œ×•×ª</th>
            </tr>
          </thead>
          <tbody>
      `;

      rides.forEach(ride => {
        const statusBadge = getStatusBadge(ride.status);
        html += `
          <tr>
            <td><strong>${ride.rideNumber || 'N/A'}</strong></td>
            <td>${ride.customerName}</td>
            <td>${ride.customerPhone}</td>
            <td>${ride.pickup || '×œ× ×¦×•×™×Ÿ'}</td>
            <td>${ride.destination || '×œ× ×¦×•×™×Ÿ'}</td>
            <td>â‚ª${ride.price || 0}</td>
            <td>${ride.driverName || '×œ× ×©×•×‘×¥'}</td>
            <td>${statusBadge}</td>
            <td class="actions">
              <button class="action-btn btn-primary" onclick="viewRide('${ride._id}')">
                <i class="fas fa-eye"></i>
              </button>
            </td>
          </tr>
        `;
      });

      html += '</tbody></table>';
      document.getElementById('ridesTable').innerHTML = html;
    }

    function filterRides() {
      const search = document.getElementById('ridesSearch').value.toLowerCase();
      const filtered = allRides.filter(ride => 
        ride.customerName?.toLowerCase().includes(search) ||
        ride.customerPhone?.includes(search) ||
        ride.rideNumber?.toLowerCase().includes(search) ||
        ride.driverName?.toLowerCase().includes(search)
      );
      renderRides(filtered);
    }

    function getStatusBadge(status) {
      const statusMap = {
        'created': '<span class="badge badge-info">× ×•×¦×¨×”</span>',
        'distributed': '<span class="badge badge-warning">××•×¤×¦×ª</span>',
        'assigned': '<span class="badge badge-warning">××©×•×‘×¦×ª</span>',
        'approved': '<span class="badge badge-warning">××•×©×¨×”</span>',
        'enroute': '<span class="badge badge-info">×‘×“×¨×š</span>',
        'arrived': '<span class="badge badge-info">×”×’×™×¢</span>',
        'finished': '<span class="badge badge-success">×”×•×©×œ××”</span>',
        'cancelled': '<span class="badge badge-danger">×‘×•×˜×œ×”</span>'
      };
      return statusMap[status] || '<span class="badge badge-info">' + status + '</span>';
    }

    // Drivers
    async function loadDrivers() {
      document.getElementById('driversTable').innerHTML = '<div class="loading"><div class="spinner"></div><p>×˜×•×¢×Ÿ...</p></div>';
      
      const drivers = await apiCall('/api/drivers');
      if (drivers) {
        allDrivers = drivers;
        renderDrivers(drivers);
      }
    }

    function renderDrivers(drivers) {
      if (!drivers || drivers.length === 0) {
        document.getElementById('driversTable').innerHTML = '<div class="empty-state"><i class="fas fa-user-tie"></i><h3>××™×Ÿ × ×”×’×™×</h3></div>';
        return;
      }

      let html = `
        <table>
          <thead>
            <tr>
              <th>×©×</th>
              <th>×˜×œ×¤×•×Ÿ</th>
              <th>××¡×¤×¨ ×¨×›×‘</th>
              <th>××–×•×¨ ×¢×‘×•×“×”</th>
              <th>× ×¡×™×¢×•×ª</th>
              <th>×“×™×¨×•×’</th>
              <th>×¡×˜×˜×•×¡</th>
              <th>×¤×¢×•×œ×•×ª</th>
            </tr>
          </thead>
          <tbody>
      `;

      drivers.forEach(driver => {
        const statusBadge = driver.isBlocked ? 
          '<span class="badge badge-danger">×—×¡×•×</span>' :
          driver.isActive ? '<span class="badge badge-success">×¤×¢×™×œ</span>' : 
          '<span class="badge badge-warning">×œ× ×¤×¢×™×œ</span>';

        html += `
          <tr>
            <td><strong>${driver.name}</strong></td>
            <td>${driver.phone}</td>
            <td>${driver.vehicleNumber || 'N/A'}</td>
            <td>${driver.workArea || 'N/A'}</td>
            <td>${driver.totalRides || 0}</td>
            <td>â­ ${driver.overallRating?.toFixed(1) || 'N/A'}</td>
            <td>${statusBadge}</td>
            <td class="actions">
              <button class="action-btn btn-primary" onclick="viewDriver('${driver._id}')">
                <i class="fas fa-eye"></i>
              </button>
              ${driver.isBlocked ? 
                `<button class="action-btn btn-success" onclick="unblockDriver('${driver._id}')"><i class="fas fa-unlock"></i></button>` :
                `<button class="action-btn btn-danger" onclick="blockDriver('${driver._id}')"><i class="fas fa-ban"></i></button>`
              }
            </td>
          </tr>
        `;
      });

      html += '</tbody></table>';
      document.getElementById('driversTable').innerHTML = html;
    }

    function filterDrivers() {
      const search = document.getElementById('driversSearch').value.toLowerCase();
      const filtered = allDrivers.filter(driver => 
        driver.name?.toLowerCase().includes(search) ||
        driver.phone?.includes(search)
      );
      renderDrivers(filtered);
    }

    // Registrations
    async function loadRegistrations() {
      document.getElementById('registrationsTable').innerHTML = '<div class="loading"><div class="spinner"></div><p>×˜×•×¢×Ÿ...</p></div>';
      
      const registrations = await apiCall('/api/registrations/pending');
      if (registrations) {
        renderRegistrations(registrations);
      }
    }

    function renderRegistrations(registrations) {
      if (!registrations || registrations.length === 0) {
        document.getElementById('registrationsTable').innerHTML = '<div class="empty-state"><i class="fas fa-user-plus"></i><h3>××™×Ÿ ×¨×™×©×•××™× ×××ª×™× ×™×</h3></div>';
        return;
      }

      let html = '<table><thead><tr><th>×©×</th><th>×˜×œ×¤×•×Ÿ</th><th>×¨×›×‘</th><th>×ª××¨×™×š</th><th>×¤×¢×•×œ×•×ª</th></tr></thead><tbody>';

      registrations.forEach(reg => {
        html += `
          <tr>
            <td><strong>${reg.name}</strong></td>
            <td>${reg.phone}</td>
            <td>${reg.carType} - ${reg.carNumber}</td>
            <td>${new Date(reg.createdAt).toLocaleDateString('he-IL')}</td>
            <td class="actions">
              <button class="action-btn btn-success" onclick="approveRegistration('${reg._id}')">
                <i class="fas fa-check"></i> ××©×¨
              </button>
              <button class="action-btn btn-danger" onclick="rejectRegistration('${reg._id}')">
                <i class="fas fa-times"></i> ×“×—×”
              </button>
            </td>
          </tr>
        `;
      });

      html += '</tbody></table>';
      document.getElementById('registrationsTable').innerHTML = html;
    }

    // Groups
    async function loadGroups() {
      document.getElementById('groupsTable').innerHTML = '<div class="loading"><div class="spinner"></div><p>×˜×•×¢×Ÿ...</p></div>';
      
      const groups = await apiCall('/api/groups');
      if (groups) {
        renderGroups(groups);
      }
    }

    function renderGroups(groups) {
      if (!groups || groups.length === 0) {
        document.getElementById('groupsTable').innerHTML = '<div class="empty-state"><i class="fas fa-users"></i><h3>××™×Ÿ ×§×‘×•×¦×•×ª</h3></div>';
        return;
      }

      let html = '<table><thead><tr><th>×©×</th><th>××¡×¤×¨ × ×”×’×™×</th><th>×‘×¨×™×¨×ª ××—×“×œ</th><th>×¤×¢×™×œ</th><th>×¤×¢×•×œ×•×ª</th></tr></thead><tbody>';

      groups.forEach(group => {
        html += `
          <tr>
            <td><strong>${group.name}</strong></td>
            <td>${group.phoneNumbers?.length || 0}</td>
            <td>${group.isDefault ? 'âœ…' : 'âŒ'}</td>
            <td>${group.isActive ? '<span class="badge badge-success">×¤×¢×™×œ</span>' : '<span class="badge badge-danger">×œ× ×¤×¢×™×œ</span>'}</td>
            <td class="actions">
              <button class="action-btn btn-primary" onclick="editGroup('${group._id}')">
                <i class="fas fa-edit"></i>
              </button>
            </td>
          </tr>
        `;
      });

      html += '</tbody></table>';
      document.getElementById('groupsTable').innerHTML = html;
    }

    // Statistics
    async function loadStatistics() {
      document.getElementById('statisticsContent').innerHTML = '<div class="loading"><div class="spinner"></div><p>×˜×•×¢×Ÿ...</p></div>';
      
      const stats = await apiCall('/api/statistics');
      const analytics = await apiCall('/api/analytics');
      
      if (stats || analytics) {
        renderStatistics(stats, analytics);
      }
    }

    function renderStatistics(stats, analytics) {
      let html = '<div class="stats-grid">';
      
      if (stats) {
        html += `
          <div class="stat-card">
            <div class="stat-icon blue"><i class="fas fa-car"></i></div>
            <div class="stat-info">
              <h3>${stats.totalRides || 0}</h3>
              <p>×¡×”"×› × ×¡×™×¢×•×ª</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon green"><i class="fas fa-user-tie"></i></div>
            <div class="stat-info">
              <h3>${stats.activeDrivers || 0}</h3>
              <p>× ×”×’×™× ×¤×¢×™×œ×™×</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon orange"><i class="fas fa-clock"></i></div>
            <div class="stat-info">
              <h3>${stats.todayRides || 0}</h3>
              <p>× ×¡×™×¢×•×ª ×”×™×•×</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon purple"><i class="fas fa-shekel-sign"></i></div>
            <div class="stat-info">
              <h3>â‚ª${stats.todayRevenue || 0}</h3>
              <p>×”×›× ×¡×•×ª ×”×™×•×</p>
            </div>
          </div>
        `;
      }
      
      html += '</div>';
      
      if (analytics) {
        html += '<div class="table-container" style="margin-top: 2rem;">';
        html += '<div class="table-header"><h2>× ×ª×•× ×™ × ×™×ª×•×—</h2></div>';
        html += `<div style="padding: 2rem;"><pre style="background: #f8f9fa; padding: 1rem; border-radius: 5px; overflow-x: auto;">${JSON.stringify(analytics, null, 2)}</pre></div>`;
        html += '</div>';
      }
      
      document.getElementById('statisticsContent').innerHTML = html;
    }

    // Activities
    async function loadActivities() {
      document.getElementById('activitiesTable').innerHTML = '<div class="loading"><div class="spinner"></div><p>×˜×•×¢×Ÿ...</p></div>';
      
      const activities = await apiCall('/api/activities');
      if (activities) {
        renderActivities(activities, 'activitiesTable');
      }
    }

    function renderActivities(activities, containerId) {
      if (!activities || activities.length === 0) {
        document.getElementById(containerId).innerHTML = '<div class="empty-state"><i class="fas fa-history"></i><h3>××™×Ÿ ×¤×¢×™×œ×•×™×•×ª</h3></div>';
        return;
      }

      let html = '<table><thead><tr><th>×–××Ÿ</th><th>×¡×•×’</th><th>×”×•×“×¢×”</th><th>××©×ª××©</th></tr></thead><tbody>';

      activities.forEach(activity => {
        const time = new Date(activity.timestamp).toLocaleString('he-IL');
        const typeEmoji = activity.emoji || 'ğŸ“';
        html += `
          <tr>
            <td>${time}</td>
            <td>${typeEmoji}</td>
            <td>${activity.message}</td>
            <td>${activity.user || '××¢×¨×›×ª'}</td>
          </tr>
        `;
      });

      html += '</tbody></table>';
      document.getElementById(containerId).innerHTML = html;
    }

    // Action functions
    function logout() {
      localStorage.removeItem('token');
      window.location.href = '/login.html';
    }

    function createNewRide() {
      alert('×™×¦×™×¨×ª × ×¡×™×¢×” ×—×“×©×” - ×‘×¤×™×ª×•×—');
    }

    function viewRide(id) {
      alert('×¦×¤×™×™×” ×‘× ×¡×™×¢×”: ' + id);
    }

    function addDriver() {
      alert('×”×•×¡×¤×ª × ×”×’ - ×‘×¤×™×ª×•×—');
    }

    function viewDriver(id) {
      alert('×¦×¤×™×™×” ×‘× ×”×’: ' + id);
    }

    async function blockDriver(id) {
      if (confirm('×”×× ×œ×—×¡×•× ××ª ×”× ×”×’?')) {
        await apiCall(`/api/drivers/${id}/block`, { method: 'POST' });
        loadDrivers();
      }
    }

    async function unblockDriver(id) {
      if (confirm('×”×× ×œ×¤×ª×•×— ×—×¡×™××” ×©×œ ×”× ×”×’?')) {
        await apiCall(`/api/drivers/${id}/unblock`, { method: 'POST' });
        loadDrivers();
      }
    }

    async function approveRegistration(id) {
      if (confirm('×”×× ×œ××©×¨ ××ª ×”×¨×™×©×•×?')) {
        await apiCall(`/api/registrations/${id}/approve`, { method: 'POST' });
        loadRegistrations();
      }
    }

    async function rejectRegistration(id) {
      const reason = prompt('×¡×™×‘×ª ×”×“×—×™×™×”:');
      if (reason) {
        await apiCall(`/api/registrations/${id}/reject`, { 
          method: 'POST',
          body: JSON.stringify({ reason })
        });
        loadRegistrations();
      }
    }

    function createGroup() {
      alert('×™×¦×™×¨×ª ×§×‘×•×¦×” - ×‘×¤×™×ª×•×—');
    }

    function editGroup(id) {
      alert('×¢×¨×™×›×ª ×§×‘×•×¦×”: ' + id);
    }

    // Load dashboard on start
    loadDashboard();
  </script>
</body>
</html>